---
title: Web 相关
---

# About Web

## 浏览器内部是如何运作的

1. 当在地址栏输入地址时，浏览器进程（Browser Process）的UI线程会捕捉输入内容，如果访问的是网址，则UI线程会启动一个网络线程来请求DNS进行域名解析，
接着开始链接服务器获取数据。如果输入的不是网址而是关键词，则会使用默认的搜索引擎进行搜索。

2. 当网络线程获取导数据之后，首先会经过浏览器自带的安全系统检测该站点是否安全，若不安全则会给出页面提示。当数据通过安全检查后，
网络线程便会通知UI线程。

3. UI线程创建一个渲染器进程（Renderer Process）来渲染页面。浏览器进程通过IPC管道将数据传递给渲染器进程，正式进入渲染流程。渲染器的核心任务就是将
html, css, js, image 等资源渲染成用户可以教会的web页面。

4. 渲染进程中的主线程将HTML进行解析，构造DOM（文档数据模型）数据结构，DOM是浏览器对页面在其内部的表示形式，是web开发者可以通过js与之交互的
数据结构和API。
HTML首先通过Tokeniser标记化，通过词法分析将输入的html内容解析成多个标记，根据识别后的标记进行DOM树构造（Tree Construction），
在DOM树构造过程中会创建document对象，然后对以document为根节点的DOM树不断进行修改，向其添加不同元素。
 > htm代码中往往会引入一些额外的资源，比如图片、css、js脚本等，图片和css这些资源可能需要通过网络下载或者从缓存中直接加载，这些资源不会
 组塞html的解析，因为他们不会影响DOM的生成。但当html解析过程中遇到script标签时，就会停止html解析，转而去加载解析并执行js，因为浏览器并不知道
 这段js是否会改变当前页面的html结构，所以需要将script标签放在合适的位置，或者使用async或defer属性来异步加载js。

5. 在html解析完成后，我们就会获得一个DOM Tree，此时主线程需要解析CSS并确定每个DOM节点的计算样式。

6. 在知道DOM结构和每个节点的样式后，主线程通过遍历和计算好的样式来生成Layout Tree，Layout Tree上的每一个节点都记录了x,y坐标和边框尺寸。
这里需要注意的是DOM Tree和Layout Tree并不是一一对应的，设置了display: none的节点不会出现在Layout Tree上，而设置了content属性的伪类不会出现
在DOM Tree里，而会出现在Layout Tree上。

7. 主线程遍历Layout Tree创建一个绘制记录表（Paint Record），该表记录了绘制的顺序，这个阶段被称之为绘制。

8. 接下来就要将所有内容转化成像素点显示在屏幕上。这种行为被称为栅格化（Rastering）。主线程遍历Layout Tree生成Layer（图层） Tree，当Layer Tree
生成完毕和绘制顺序确定后，主线程将这些信息传递给合成器线程，合成器线程将每个图层栅格化，由于一层可能像页面的整个长度一样大，因此合成器线程将
他们切分为许多图块（tiles），然后将每个图块发给栅格化线程（Raster Thread），栅格化线程栅格化每个图块，并将它们存储在GPU内存中。当图块栅格化完成后，
合成器线程将收集被称为“draw quads”的图块信息，这些信息里记录了图块在内存中的位置，和在页面的哪个位置绘制这些图块的信息。根据这些信息合成器线程
生成了一个合成器帧（Compositor Frame），然后这个合成器帧通过IPC传送给浏览器进程，接着浏览器进程将合成器帧传送到GPU，然后GPU渲染展示到屏幕上。

9.当页面再次变化时，例如滚动，都会生成新的合成器帧，再传送给GPU，再次渲染。

###总结


